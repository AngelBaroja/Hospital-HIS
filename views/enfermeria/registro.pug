extends ../layout

block content 
    .pestanas 
        .pestana 1. Pacientes Internados
        .pestana.activa2 2. Registro
        .pestana 3. Historial Médico
    .contenido-pestana#recepcion
        h2 Datos Basicos del Paciente               
        p#texto Información inicial de la admisión del paciente.

        form#formulario-registro(action="/enfermeria/registro" method="POST")
            input(type="hidden" name="recepcion" value=recepciones)            
            h3 Datos del Paciente
            span           
            .formulario-grid
                .grupo-formulario 
                    label(for="dni") DNI
                    input(type="text" value=recepciones.Paciente.dni placeholder="Ingrese el DNI" name="dni" minlength="7" maxlength="8" required)#dni
                
                .grupo-formulario 

                .grupo-formulario
                    label(for="nombre") Nombre                    
                    input(type="text" value=recepciones.Paciente.nombre placeholder="Ingrese el nombre" name="nombre" minlength="3" maxlength="20" required)#nombre

                .grupo-formulario
                    label(for="apellido") Apellido                    
                    input(type="text" value=recepciones.Paciente.apellido placeholder="Ingrese el apellido" name="apellido" minlength="3" maxlength="20"  required)#apellido

                .grupo-formulario 
                    label(for="fecha_nacimiento") Fecha de Nacimiento
                    input(type="date" value=recepciones.Paciente.fecha_nacimiento placeholder="Ingrese la fecha de nacimiento" name="fecha_nacimiento")#fecha_nacimiento
                    
                .grupo-formulario 
                    label(for="genero") Género
                    select#genero(name="genero" required)
                        option(value="") Seleccione...
                        if recepciones.Paciente.genero == 'Masculino'
                            option(value="Masculino" selected) Masculino
                            option(value="Femenino") Femenino
                            option(value="No especificado") No especificado
                        else if recepciones.Paciente.genero == 'Femenino'
                            option(value="Masculino") Masculino
                            option(value="Femenino" selected) Femenino
                            option(value="No especificado") No especificado
                        else  
                            option(value="Masculino") Masculino
                            option(value="Femenino") Femenino
                            option(value="No especificado" selected) No especificado

                .grupo-formulario 
                    label(for="telefono") Numero de Celular
                    input(type="text" value=recepciones.Paciente.contacto placeholder="Ingrese el número de celular" name="contacto" minlength="10" maxlength="10")#contacto                   
                
                .grupo-formulario 
                    label(for="Contacto_emergencia") Contacto de Emergencia
                    if recepciones.Paciente.Contacto_Emergencia && recepciones.Paciente.Contacto_Emergencia.length > 0
                        each contacto in recepciones.Paciente.Contacto_Emergencia
                            input(type="text" value=contacto.numero placeholder="Ingrese el contacto de emergencia" name="contacto_emergencia" minlength="10" maxlength="10" class="input-contacto-extra" style="margin-bottom:5px")
                    input(type="text" placeholder="Ingrese el contacto de emergencia" name="contacto_emergencia" minlength="10" maxlength="10" style="margin-bottom:5px" id="contacto_emergencia")
                    button(type="button" class="boton-agregar" onclick="agregarContactoEmergencia()") Agregar
                    button(type="button" class="boton-quitar" onclick="quitarContactoEmergencia()") Quitar

                
                .grupo-formulario 
                    label(for="direccion") Dirección
                    input(type="text" value=recepciones.Paciente.direccion placeholder="Ingrese la dirección" name="direccion" minlength="3" maxlength="30"  required)#direccion                    

                .grupo-formulario 
                    label(for="provincia") Provincia
                    input(type="text" value=recepciones.Paciente.provincia placeholder="Ingrese la provincia" name="provincia"  minlength="3" maxlength="30"  required)#direccion

                .grupo-formulario 
                    label(for="localidad") Localidad
                        input(type="text" value=recepciones.Paciente.localidad placeholder="Ingrese la localidad" name="localidad"  minlength="3" maxlength="30"  required)#direccion

                .grupo-formulario

                .grupo-formulario 
                    h3 Datos de la Mutual

                .grupo-formulario  

                .grupo-formulario                     
                    label(for="seguro") Seguro Médico                    
                    select#seguro(name="seguro" )
                        option(value="") Seleccione...
                        each mutual in mutuales
                            if recepciones.Paciente.Mutual_Paciente && recepciones.Paciente.Mutual_Paciente.Mutual && mutual.nombre == recepciones.Paciente.Mutual_Paciente.Mutual.nombre
                                option(value=mutual.nombre selected) #{mutual.nombre}
                            else
                                option(value=mutual.nombre) #{mutual.nombre}
                
                .grupo-formulario 
                    label(for="codigo_mutual") Credencial Nº
                    if recepciones.Paciente.Mutual_Paciente
                        input(type="text" value=recepciones.Paciente.Mutual_Paciente.codigo_mutual placeholder="Ingrese el codigo de la credencial" name="codigo_mutual" minlength="5" maxlength="5")#codigo_mutual
                    else
                        input(type="text" placeholder="Ingrese el codigo de la credencial" name="codigo_mutual" minlength="5" maxlength="5")#codigo_mutual
                        
                .grupo-formulario   
                    label(for="tipo_cobertura") Tipo de Cobertura 
                    if recepciones.Paciente.Mutual_Paciente
                        select#tipo_cobertura(name="tipo_cobertura")
                            option(value="") Seleccione...
                            if recepciones.Paciente.Mutual_Paciente.tipo_cobertura == 'Basico'
                                option(value="Basico" selected) Básico
                                option(value="Completo") Completo
                                option(value="Premium") Premium
                            else if recepciones.Paciente.Mutual_Paciente.tipo_cobertura == 'Completo'
                                option(value="Basico") Básico
                                option(value="Completo" selected) Completo
                                option(value="Premium") Premium
                            else if recepciones.Paciente.Mutual_Paciente.tipo_cobertura == 'Premium'
                                option(value="Basico") Básico
                                option(value="Completo") Completo
                                option(value="Premium" selected) Premium
                    else
                        select#tipo_cobertura(name="tipo_cobertura")
                            option(value="") Seleccione...
                            option(value="Basico") Básico
                            option(value="Completo") Completo
                            option(value="Premium") Premium

                .grupo-formulario 
                    label(for="activa") Mutual Activa
                    if recepciones.Paciente.Mutual_Paciente
                        if recepciones.Paciente.Mutual_Paciente.activa == true
                            select#mutual_activa(name="activa")
                                option(value="") Seleccione...
                                option(value="Activa" selected) Activa
                                option(value="Inactiva") Inactiva
                        else
                            select#mutual_activa(name="activa")
                                option(value="") Seleccione...
                                option(value="Activa") Activa
                                option(value="Inactiva" selected) Inactiva                        
                    else
                        select#mutual_activa(name="activa")
                            option(value="") Seleccione...
                            option(value="Activa") Activa
                            option(value="Inactiva") Inactiva
                         
                h3 Motivo de la Internación
                span
                .grupo-formulario 
                    label(for="motivo") Motivo de la Internación
                    select#motivo(name="motivo" required)
                        option(value="") Seleccione...
                        each motivo in motivos
                            if motivo.tipos == recepciones.Motivo.tipos
                                option(value=motivo.tipos selected) #{motivo.tipos}
                            else                               
                                option(value=motivo.tipos) #{motivo.tipos}
                      
                .grupo-formulario 
                    label(for="detalle_motivo") Detalle de la Internación
                    if recepciones.detalle_motivo
                        textarea(rows="3" placeholder="Ingrese detalles del motivo de la internacion" name="detalle_motivo"  required)= recepciones.detalle_motivo
                    else
                        textarea(rows="3" placeholder="Ingrese detalles del motivo de la internacion" name="detalle_motivo")#detalle_motivo
                
            .botones-accion             
                span 
                button(type="submit" class="boton boton-primario") Continuar
        
        form(action="/enfermeria/pacientesInternados" method="GET" style ="margin-top: -48px;")            
            button(type="submit" class="boton boton-secundario") Atrás
        script.
            function agregarContactoEmergencia() {
                var input = document.getElementById('contacto_emergencia');
                var valor = input.value.trim();
                var error = document.getElementById('error');
                if (error) error.remove();

                // Validar vacío
                if (!valor) {
                    mostrarError('Primero agregue un número de emergencia');
                    return;
                }
                // Validar 10 dígitos numéricos
                if (!/^\d{10}$/.test(valor)) {
                    mostrarError('El número de celular es incorrecto');
                    return;
                }
                // Crear nuevo input readonly después del input principal
                var nuevoInput = document.createElement('input');
                nuevoInput.type = 'text';
                nuevoInput.name = 'contacto_emergencia';
                nuevoInput.value = valor;
                nuevoInput.readOnly = true;
                nuevoInput.className = 'input-contacto-extra';
                nuevoInput.style.marginBottom = '5px';
                input.parentNode.insertBefore(nuevoInput, input); // Insertar antes del input editable

                // Limpiar el input original
                input.value = '';
            }

            function quitarContactoEmergencia() {
                var error = document.getElementById('error');
                if (error) error.remove();
                // Selecciona todos los inputs readonly de contacto extra
                var contactos = document.querySelectorAll('.input-contacto-extra');
                if (contactos.length > 0) {
                    // Elimina solo el último input (el más cercano al input editable)
                    contactos[contactos.length - 1].remove();
                } else {
                    mostrarError('No hay contactos de emergencia para quitar');
                }
            }

            function mostrarError(mensaje) {
                var input = document.getElementById('contacto_emergencia');
                var error = document.createElement('div');
                error.id = 'error';
                error.style.color = 'red';
                error.style.fontSize = '13px';
                error.textContent = mensaje;
                input.parentNode.appendChild(error);
            }               
                
        